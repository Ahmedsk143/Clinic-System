<app-nav Header="Patient Data" [Back]="true" [Route]="'../../home'"></app-nav>
<p-toast></p-toast>
<div class="patient">
  <div class="patient__content">
    <h1 class="patient__title">Patient Data</h1>
    <div class="header" [ngClass]="{ printable: !isSight }">
      <div class="en-data">
        <span>DR.</span>
        <strong>ESSAM KHEDR</strong>
        <span> Consultant and Eye Surgeon </span>
        <span>Member of the Egyptian Society of Catarct and Refraction </span>
        <span>Laser therapy specialist</span>
      </div>
      <img src="../../../assets/eye.svg" alt="" />
      <div class="ar-data">
        <span>دكتور</span>
        <strong>عصام خضر</strong>
        <span>إستشارى وجراح العيون</span>
        <span>عضو الجمعية المصرية للمياة البيضاء والانكسار</span>
        <span>أخصائي العلاج بالليزر</span>
      </div>
    </div>
    <div class="body" [ngClass]="{ printable: !isSight }">
      <div>
        <div class="">Name: {{ patientData.name }}</div>
        <div class="">Date: {{ patientData.date | date: "dd/M/yyyy" }}</div>
      </div>
      <div>
        <div class="">Diagnose: {{ patientData.diagnoses }}</div>
        <div class="">
          BCVA: RT: {{ patientData.visualAcuity.rbcva }} / LT:
          {{ patientData.visualAcuity.lbcva }}
        </div>
      </div>
    </div>
    <div class="footer" [ngClass]="{ printable: !isSight }">
      <div class="address">
        <span> الإسماعلية-الشيخ زايد-برج الطلائع رقم</span>
        <span>(٢١)</span>
        <span> اول الشارع التجاري بجوار مسجد ابو المجد </span>
        <span><i class="fa-solid fa-location-dot"></i></span>
      </div>
      <div class="phone">
        ت العيادة: ۰٦٤/۳۱۱۳۳۹٥ - ۰۱۰۲۰۸۸۰۸٦۰
        <i class="fa-solid fa-square-phone"></i>
      </div>
      <div style="text-align: center">
        ( الاستشارة خلال اسبوع من تاريخ الكشف )
      </div>
    </div>
    <div class="patient__data hide">
      <div class="patient__name">Name: {{ patientData.name }}</div>
      <div class="patient__date">Date: {{ patientData.date }}</div>
      <div class="patient__age">Age: {{ patientData.age }}</div>
      <div class="patient__phone">Phone: {{ patientData.phoneNumber }}</div>
      <div class="patient__gender">Gender: {{ patientData.gender }}</div>
      <div class="patient__fileNo">File number: {{ patientData.fileNo }}</div>
      <div class="patient__id">ID: {{ patientData._id }}</div>
      <div class="patient__id">Type: {{ patientData.appointmentType }}</div>
    </div>
    <form
      class="patient__form"
      (ngSubmit)="addSight()"
      [formGroup]="sightForm"
      [ngClass]="{ disabled: type == 'nurse' }"
    >
      <div class="patient__sight" [ngClass]="{ hide: !isSight }">
        <div class="patient__sight-1">
          <div class="name">Name: {{ patientData.name }}</div>
          <div class="date">
            Date: {{ patientData.date | date: "d/M/yyyy" }}
          </div>
          <div class="fileNo">File number: {{ patientData.fileNo }}</div>
          <label>IP.D: </label>
          <label for="far">Far</label>
          <input class="input" type="number" id="far" formControlName="far" />
          <label for="far">Near </label>
          <input class="input" type="number" id="near" formControlName="near" />
          <label for="RT">BCVA: </label>
          <label for="RT">RT </label>
          <input class="input" type="number" id="RT" formControlName="rbcva" />
          <label for="LT">LT</label>
          <input class="input" type="number" id="LT" formControlName="lbcva" />
          <div>
            <label for="note">Notes:</label>
            <input class="input" formControlName="note" id="note" />
          </div>
        </div>
        <div class="patient__sight-2">
          <table>
            <thead>
              <tr>
                <td></td>
                <td colspan="3">Right</td>
                <td colspan="3">Left</td>
              </tr>
              <tr>
                <td></td>
                <td>Sph</td>
                <td>Cyl</td>
                <td>Axis</td>
                <td>Sph</td>
                <td>Cyl</td>
                <td>Axis</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>D</td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="rdsph"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="rdcyl"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="rdaxis"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="ldsph"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="ldcyl"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="ldaxis"
                  />
                </td>
              </tr>
              <tr>
                <td>R</td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="rrsph"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="rrcyl"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="rraxis"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="lrsph"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="lrcyl"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    step="0.5"
                    class="input"
                    formControlName="lraxis"
                  />
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="patient__form__action">
          <button class="btn-1" *ngIf="type == 'doctor'">Save</button>
          <button type="button" class="btn-2" (click)="printSight()">
            <span></span>Print
          </button>
        </div>
      </div>
    </form>

    <!-- Check -->
    <div class="patient__meds" [ngClass]="{ hide: isSight }">
      <span class="R"></span>
      <h4>Medications</h4>
      <h4>Type</h4>
      <h4>No.Takes</h4>
      <h4>Period</h4>
      <span class="action"></span>
      <ng-container *ngFor="let item of items">
        <span class="R">R/</span>
        <select
          [disabled]="type == 'nurse'"
          class="input"
          [(ngModel)]="item.name"
          [ngModelOptions]="{ standalone: true }"
        >
          <option value="" selected>Select Drug</option>
          <ng-container *ngFor="let drug of drugs">
            <option
              [ngValue]="drug.name"
              *ngIf="drug.type === item.selectedType"
            >
              {{ drug.name }}
            </option>
          </ng-container>
        </select>
        <select
          [disabled]="type == 'nurse'"
          class="input"
          [(ngModel)]="item.selectedType"
          [ngModelOptions]="{ standalone: true }"
        >
          <option *ngFor="let type of drugTypes" [ngValue]="type">
            {{ type }}
          </option>
        </select>
        <input
          [disabled]="type == 'nurse'"
          class="input"
          min="1"
          [(ngModel)]="item.noOfTakes"
        />

        <input
          [disabled]="type == 'nurse'"
          class="input"
          [(ngModel)]="item.period"
        />
        <span class="action" (click)="item.note = ' '" *ngIf="type === 'doctor'"
          ><i class="fa-regular fa-note-sticky"></i
        ></span>

        <div class="drug-note" *ngIf="item.note !== ''">
          <label for="medNote">Note: </label>
          <input
            [disabled]="type == 'nurse'"
            class="input"
            [(ngModel)]="item.note"
            id="medNote"
          />
          <span class="remove-note" (click)="item.note = ''"
            ><i class="fa-solid fa-x"></i
          ></span>
        </div>
      </ng-container>
    </div>
    <button
      class="btn-1"
      type="button"
      (click)="addNewDrug()"
      *ngIf="type == 'doctor'"
    >
      <!-- <i class="fa-solid fa-kit-medical"></i> -->
      Add new
    </button>
    <div class="hide diagnose">
      <span>Diagnose:</span>
      <input type="text" [(ngModel)]="diagnose" class="input" />
    </div>
    <div class="notes" [ngClass]="{ hide: isSight }">
      <span>Notes:</span>
      <textarea
        class="input"
        rows="4"
        [(ngModel)]="checkNote"
        [disabled]="type === 'nurse'"
      ></textarea>
    </div>
    <div class="patient__form__action">
      <button
        class="btn-1"
        *ngIf="type == 'doctor'"
        type="button"
        (click)="addCheck()"
      >
        Save
      </button>
      <div
        style="margin-right: auto; margin-left: 10px; display: flex"
        *ngIf="type == 'nurse'"
      >
        <button class="btn-1" (click)="MakeAppint()" type="button">
          Appointment
        </button>
        <button class="btn-1" (click)="MakeConsultant()" type="button">
          Consultant
        </button>
      </div>
      <button type="button" class="btn-2" (click)="printMeds()">
        <span></span>Print
      </button>
    </div>
  </div>
</div>
<div
  class="mark-treated hide"
  *ngIf="type == 'doctor'"
  (click)="removeFromWaiting()"
>
  Mark as Treated
  <i class="fa-solid fa-check"></i>
</div>
